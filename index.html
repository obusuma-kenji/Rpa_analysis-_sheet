<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>業種別 業務見える化ツール</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSSは前回のものから大きな変更はありません */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 900px; width: 100%; margin: 0 auto; overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white; padding: 30px; text-align: center;
        }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .step-indicator {
            background: #f8f9fa; padding: 20px; border-bottom: 1px solid #dee2e6; text-align: center;
        }
        .steps { display: flex; justify-content: center; align-items: center; gap: 20px; }
        .step { display: flex; align-items: center; gap: 10px; }
        .step-circle {
            width: 30px; height: 30px; border-radius: 50%; background: #dee2e6;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: white; transition: background-color 0.3s ease;
        }
        .step.active .step-circle { background: #00b894; }
        .step.completed .step-circle { background: #00a085; }
        .content { padding: 40px; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .form-group { margin-bottom: 25px; text-align: left; position: relative; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        .form-group input, .form-group select {
            width: 100%; padding: 12px; border: 2px solid #dee2e6;
            border-radius: 8px; font-size: 1em; transition: border-color 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus { border-color: #00b894; outline: none; }
        .error-message { color: #d63031; font-size: 0.85em; margin-top: 5px; }
        input.invalid, select.invalid { border-color: #d63031 !important; }

        .task-input {
            background: #f8f9fa; border-radius: 10px; padding: 25px; margin-bottom: 20px;
        }
        .input-row {
            display: grid; grid-template-columns: 2fr 1fr 1fr auto;
            gap: 15px; margin-bottom: 15px; align-items: end;
        }
        .add-task-btn {
            background: #00b894; color: white; border: none; padding: 10px 20px;
            border-radius: 5px; cursor: pointer; font-size: 0.9em; height: 40px;
        }
        .task-list { margin-top: 20px; }
        .task-item {
            background: white; border: 1px solid #dee2e6; border-radius: 8px;
            padding: 15px; margin-bottom: 10px; display: flex;
            justify-content: space-between; align-items: center;
        }
        .delete-btn {
            background: #e74c3c; color: white; border: none; padding: 5px 10px;
            border-radius: 3px; cursor: pointer; font-size: 0.8em;
        }
        .results { text-align: center; }
        .time-summary {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin: 30px 0;
        }
        .summary-card {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white; padding: 25px; border-radius: 15px; text-align: center;
        }
        .summary-card .big-number { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .chart-container {
            background: white; border: 1px solid #dee2e6; border-radius: 10px;
            padding: 20px; margin: 20px 0; position: relative;
            max-width: 450px; margin-left: auto; margin-right: auto;
        }
        .automation-suggestions {
            background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 10px;
            padding: 20px; margin-top: 20px; text-align: left;
        }
        .suggestion-item {
            background: white; border-radius: 8px; padding: 15px;
            margin-bottom: 10px; border-left: 4px solid #e17055;
        }
        .navigation {
            display: flex; justify-content: space-between;
            margin-top: 30px; gap: 15px;
        }
        .btn {
            padding: 12px 25px; border: none; border-radius: 8px;
            cursor: pointer; font-size: 1em; transition: all 0.3s ease; flex: 1;
        }
        .btn-primary { background: #00b894; color: white; }
        .btn-secondary { background: #b2bec3; color: white; }
        .btn-danger { background: #d63031; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .help-text {
            background: #e8f4f8; border-left: 4px solid #74b9ff;
            padding: 15px; margin: 20px 0; border-radius: 0 8px 8px 0; text-align: left;
        }
        
        @media (max-width: 768px) {
            .input-row { grid-template-columns: 1fr; gap: 10px; }
            .navigation { flex-direction: column; }
            .task-item { flex-direction: column; align-items: start; gap: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 業種別 業務見える化ツール</h1>
            <p>あなたの業種に合わせて、普段の作業を記録し、改善点を見つけましょう</p>
        </div>
        
        <div class="step-indicator">
            <div class="steps">
                <div class="step active" id="step1"> <div class="step-circle">1</div> <span>基本情報</span> </div>
                <div class="step" id="step2"> <div class="step-circle">2</div> <span>作業記録</span> </div>
                <div class="step" id="step3"> <div class="step-circle">3</div> <span>結果表示</span> </div>
            </div>
        </div>
        
        <div class="content">
            <div class="section active" id="section1">
                <h2 style="text-align: center;">まずはあなたの情報を教えてください</h2>
                <div class="help-text">
                    <h4>💡 このツールの使い方</h4>
                    <p>業種を選択すると、次のステップでその業種でよくある作業が候補として表示されます。より簡単に、より正確に業務を洗い出せます。</p>
                </div>
                
                <div class="form-group">
                    <label for="userName">お名前（ニックネームでもOK）</label>
                    <input type="text" id="userName" placeholder="例：田中">
                </div>
                
                <div class="form-group">
                    <label for="industry">あなたの業種を選択してください</label>
                    <select id="industry">
                        <option value="">選択してください</option>
                        <option value="it">IT / Webエンジニア</option>
                        <option value="sales">営業</option>
                        <option value="admin">事務 / バックオフィス</option>
                        <option value="retail">小売 / 接客</option>
                        <option value="medical">医療 / 介護</option>
                        <option value="manufacturing">製造</option>
                        <option value="other">その他</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="workDays">週何日働いていますか？</label>
                    <select id="workDays">
                        <option value="">選択してください</option>
                        <option value="3">週3日</option>
                        <option value="4">週4日</option>
                        <option value="5">週5日</option>
                        <option value="6">週6日</option>
                    </select>
                </div>
            </div>
            
            <div class="section" id="section2">
                <h2>普段の作業を記録してみましょう</h2>
                <div class="help-text">
                    <h4>📝 記録のコツ</h4>
                    <p>入力欄をクリックすると、あなたの業種で一般的な作業が候補として表示されます。もちろん、候補にない作業は自由に入力できます。</p>
                </div>
                
                <div class="task-input">
                    <h3>作業を追加する</h3>
                    <div class="input-row">
                        <div class="input-col">
                            <label>作業名</label>
                            <input type="text" id="taskName" list="taskSuggestions" placeholder="クリックして候補を表示 / 自由入力">
                            <datalist id="taskSuggestions"></datalist>
                        </div>
                        <div class="input-col"> <label>頻度</label> <select id="taskFreq"> <option value="">選択</option> <option value="5">毎日</option> <option value="2.5">週2-3回</option> <option value="1">週1回</option> <option value="0.5">月数回</option> </select> </div>
                        <div class="input-col"> <label>1回の時間(分)</label> <input type="number" id="taskTime" placeholder="例: 30"> </div>
                        <div class="input-col"> <button class="add-task-btn" id="addTaskBtn">追加</button> </div>
                    </div>
                </div>
                
                <div class="task-list">
                    <h3>記録した作業</h3>
                    <div id="tasks"></div>
                </div>
            </div>
            
            <div class="section" id="section3">
                <h2 style="text-align: center;">📊 あなたの業務分析結果</h2>
                <div class="time-summary" id="timeSummary"></div>
                <div class="chart-container">
                    <h3>作業時間の内訳 (週あたり)</h3>
                    <canvas id="taskChartCanvas"></canvas>
                </div>
                <div class="automation-suggestions" id="automationSuggestions"></div>
                <div style="text-align:center;">
                    <button class="btn btn-danger" id="resetBtn" style="margin-top: 20px; max-width: 200px;">最初からやり直す</button>
                </div>
            </div>
            
            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" disabled>← 前へ</button>
                <button class="btn btn-primary" id="nextBtn">次へ →</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // 業種別の典型的なタスクリスト
    const industryTasks = {
        it: ['コーディング', '要件定義・設計', 'テスト・デバッグ', 'コードレビュー', '定例ミーティング', 'ドキュメント作成', 'インフラ監視・保守', '技術調査'],
        sales: ['新規顧客へのアプローチ', '既存顧客との打ち合わせ', '提案資料作成', '見積書作成', 'CRMへの情報入力', '社内報告・会議', '移動', 'テレアポ'],
        admin: ['メール・電話対応', 'データ入力・集計', '請求書・契約書処理', '備品管理・発注', '来客対応', 'ファイリング・書類整理', '勤怠管理'],
        retail: ['接客・レジ対応', '商品陳列・品出し', '在庫管理・発注', '店内清掃', '売上報告・日報作成', 'クレーム対応', '朝礼・終礼'],
        medical: ['患者・利用者対応', 'カルテ・記録の記入', 'カンファレンス・申し送り', '薬剤・備品準備', 'バイタルサイン測定', '家族への説明・対応', '環境整備・清掃'],
        manufacturing: ['生産ラインでの作業', '品質検査', '機械の点検・メンテナンス', '生産計画の確認', '原材料の準備・運搬', '不良品の処理・報告', '安全パトロール'],
        other: ['メール対応', 'データ入力', '電話対応', '資料作成', '会議']
    };

    // 業種別の効率化提案ルール
    const suggestionRules = {
        it: [
            { pattern: /テスト|デバッグ/, s: 'テスト自動化ツール(Selenium, Playwright等)の導入で、リグレッションテストの工数を大幅に削減できます。', e: '70-90%削減' },
            { pattern: /コーディング|開発/, s: 'CI/CDツールの導入やLinter/Formatterの自動化で、ビルドやコード品質チェックの手間を省けます。', e: '20-40%削減' },
            { pattern: /インフラ監視|保守/, s: '監視ツールの通知設定最適化や、定型的な保守作業のスクリプト化が有効です。', e: '50-80%削減' },
        ],
        sales: [
            { pattern: /CRM|情報入力/, s: 'CRM連携ツールや名刺スキャンアプリの活用で、手入力を減らし、データの正確性も向上します。', e: '60-80%削減' },
            { pattern: /資料作成|見積書/, s: '提案書や見積書のテンプレートを高度化し、自動で顧客情報を反映させる仕組みを構築しましょう。', e: '40-70%削減' },
            { pattern: /報告/, s: 'SFA/CRMのダッシュボード機能を活用し、報告書作成の手間を省き、リアルタイムな情報共有に切り替えましょう。', e: '50-80%削減' },
        ],
        admin: [
            { pattern: /請求書|契約書/, s: 'クラウド請求書発行システムや電子契約サービスを導入すると、印刷・郵送・ファイリングの手間がなくなります。', e: '70-90%削減' },
            { pattern: /データ入力|集計/, s: 'RPA(Robotic Process Automation)ツールやExcelマクロ/Power Queryで、反復的な入力・集計作業を自動化できます。', e: '80-95%削減' },
        ],
        retail: [
            { pattern: /在庫管理|発注/, s: 'POSデータと連携した自動発注システムや、ハンディターミナルを導入することで、作業の精度と速度が向上します。', e: '50-70%削減' },
            { pattern: /シフト作成/, s: 'AI搭載のシフト管理システムを導入し、従業員の希望と繫忙期を考慮した最適なシフトを自動生成しましょう。', e: '60-80%削減' },
        ],
        medical: [
            { pattern: /カルテ|記録/, s: '音声入力対応の電子カルテシステムや、定型文のテンプレート機能を活用することで、記録時間を大幅に短縮できます。', e: '40-60%削減' },
            { pattern: /申し送り|カンファレンス/, s: '情報共有ツールやチャットツールを活用し、リアルタイムでの情報更新と確認を徹底することで、会議時間を短縮できます。', e: '30-50%削減' },
        ],
        manufacturing: [
            { pattern: /品質検査/, s: '画像認識AIを活用した外観検査システムを導入することで、見逃しを減らし、検査員の負担を軽減できます。', e: '60-80%削減' },
            { pattern: /点検|報告/, s: 'タブレット端末で入力できる点検報告アプリを導入し、ペーパーレス化とデータ集計の自動化を実現しましょう。', e: '50-70%削減' },
        ],
        // デフォルトのルール
        default: [
            { pattern: /メール|連絡|問い合わせ/, s: 'テンプレートや自動返信、振り分けルールの活用で時間短縮が期待できます。', e: '30-50%削減' },
            { pattern: /データ|入力|転記|コピー/, s: 'RPAやスクリプトによる自動化で、作業時間を大幅に削減できる可能性があります。', e: '80-95%削減' },
            { pattern: /集計|計算|レポート/, s: 'ExcelマクロやBIツールを導入することで、手作業をなくし即時に結果を得られます。', e: '70-90%削減' },
            { pattern: /報告|資料作成|議事録/, s: '定型フォーマットの作成や、音声入力ツールの活用で効率化できます。', e: '40-60%削減' },
        ]
    };
    
    const App = {
        elements: {
            sections: document.querySelectorAll('.section'),
            steps: document.querySelectorAll('.step'),
            nextBtn: document.getElementById('nextBtn'),
            prevBtn: document.getElementById('prevBtn'),
            resetBtn: document.getElementById('resetBtn'),
            userName: document.getElementById('userName'),
            industry: document.getElementById('industry'), // 追加
            workDays: document.getElementById('workDays'),
            taskName: document.getElementById('taskName'),
            taskFreq: document.getElementById('taskFreq'),
            taskTime: document.getElementById('taskTime'),
            addTaskBtn: document.getElementById('addTaskBtn'),
            tasksContainer: document.getElementById('tasks'),
            taskSuggestions: document.getElementById('taskSuggestions'), // 追加
            timeSummary: document.getElementById('timeSummary'),
            automationSuggestions: document.getElementById('automationSuggestions'),
            taskChartCanvas: document.getElementById('taskChartCanvas'),
        },
        state: {
            currentStep: 1,
            tasks: [],
            userData: {},
            chartInstance: null,
        },
        init() {
            this.loadState();
            this.bindEvents();
            this.goToStep(this.state.currentStep, true);
            this.updateTaskList();
        },
        bindEvents() {
            this.elements.nextBtn.addEventListener('click', () => this.nextStep());
            this.elements.prevBtn.addEventListener('click', () => this.prevStep());
            this.elements.addTaskBtn.addEventListener('click', () => this.addTask());
            this.elements.tasksContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-btn')) {
                    this.deleteTask(parseInt(e.target.dataset.id));
                }
            });
            this.elements.resetBtn.addEventListener('click', () => this.resetApp());
        },
        nextStep() {
            if (this.state.currentStep === 1) {
                if (this.validateBasicInfo()) this.goToStep(2);
            } else if (this.state.currentStep === 2) {
                if (this.state.tasks.length > 0) {
                    this.generateResults();
                    this.goToStep(3);
                } else {
                    alert('作業を最低1つは記録してください');
                }
            }
        },
        prevStep() {
            if (this.state.currentStep > 1) this.goToStep(this.state.currentStep - 1);
        },
        goToStep(step, isInitialLoad = false) {
            this.state.currentStep = step;
            this.elements.sections.forEach(s => s.classList.remove('active'));
            document.getElementById(`section${step}`).classList.add('active');
            this.elements.steps.forEach(s => {
                s.classList.remove('active', 'completed');
                const stepNum = parseInt(s.id.replace('step', ''));
                if (stepNum < step) s.classList.add('completed');
                if (stepNum === step) s.classList.add('active');
            });
            this.elements.prevBtn.disabled = step === 1;
            this.elements.nextBtn.style.display = step === 3 ? 'none' : 'block';

            if (step === 2) {
                this.updateTaskSuggestions(); // Step2に移動したらサジェストを更新
            }

            if (!isInitialLoad) this.saveState();
        },
        validateBasicInfo() {
            this.clearErrors();
            let isValid = true;
            const name = this.elements.userName.value.trim();
            const industry = this.elements.industry.value;
            const days = this.elements.workDays.value;

            if (!name) { this.showError(this.elements.userName, 'お名前を入力してください'); isValid = false; }
            if (!industry) { this.showError(this.elements.industry, '業種を選択してください'); isValid = false; }
            if (!days) { this.showError(this.elements.workDays, '週の労働日数を選択してください'); isValid = false; }
            
            if (isValid) {
                this.state.userData = { name, industry, days: parseInt(days) };
                this.saveState();
            }
            return isValid;
        },
        showError(element, message) {
            element.classList.add('invalid');
            const error = document.createElement('div');
            error.className = 'error-message';
            error.textContent = message;
            element.parentNode.insertBefore(error, element.nextSibling);
        },
        clearErrors() {
            document.querySelectorAll('.error-message').forEach(e => e.remove());
            document.querySelectorAll('.invalid').forEach(e => e.classList.remove('invalid'));
        },
        updateTaskSuggestions() {
            const industry = this.state.userData.industry || 'other';
            const tasks = industryTasks[industry] || industryTasks['other'];
            this.elements.taskSuggestions.innerHTML = tasks.map(task => `<option value="${task}">`).join('');
        },
        addTask() {
            const name = this.elements.taskName.value.trim();
            const freqMultiplier = parseFloat(this.elements.taskFreq.value);
            const time = parseInt(this.elements.taskTime.value);
            
            if (!name || !freqMultiplier || !time || time <= 0) {
                alert('すべての項目を正しく入力してください');
                return;
            }
            
            const weeklyHours = (time * freqMultiplier) / 60;
            const task = {
                id: Date.now(),
                name,
                freq: this.elements.taskFreq.options[this.elements.taskFreq.selectedIndex].text,
                time,
                weeklyHours: Math.round(weeklyHours * 10) / 10
            };
            
            this.state.tasks.push(task);
            this.updateTaskList();
            this.saveState();
            this.clearInputs();
        },
        updateTaskList() {
            const container = this.elements.tasksContainer;
            if (this.state.tasks.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">まだ作業が記録されていません</p>';
                return;
            }
            container.innerHTML = this.state.tasks.map(task => `
                <div class="task-item">
                    <div> <div class="task-name">${task.name}</div> <div class="task-details">${task.freq} × ${task.time}分</div> </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="time-badge">週 ${task.weeklyHours.toFixed(1)} 時間</div>
                        <button class="delete-btn" data-id="${task.id}">削除</button>
                    </div>
                </div>
            `).join('');
        },
        deleteTask(id) {
            this.state.tasks = this.state.tasks.filter(task => task.id !== id);
            this.updateTaskList();
            this.saveState();
        },
        clearInputs() {
            this.elements.taskName.value = '';
            this.elements.taskFreq.value = '';
            this.elements.taskTime.value = '';
        },
        generateResults() {
            this.renderSummaryCards();
            this.renderChart();
            this.renderAutomationSuggestions();
        },
        renderSummaryCards() {
            const totalWeeklyHours = this.state.tasks.reduce((sum, task) => sum + task.weeklyHours, 0);
            const totalMonthlyHours = totalWeeklyHours * 4.3;
            const topTask = this.state.tasks.length > 0 ? this.state.tasks.reduce((max, task) => task.weeklyHours > max.weeklyHours ? task : max, this.state.tasks[0]) : { name: 'N/A', weeklyHours: 0 };
            this.elements.timeSummary.innerHTML = `
                <div class="summary-card"> <h3>週間作業時間</h3> <div class="big-number">${totalWeeklyHours.toFixed(1)}h</div> <p>記録した作業の合計</p> </div>
                <div class="summary-card"> <h3>月間作業時間</h3> <div class="big-number">${Math.round(totalMonthlyHours)}h</div> <p>週間×4.3週で計算</p> </div>
                <div class="summary-card"> <h3>最長作業</h3> <div class="big-number">${topTask.weeklyHours.toFixed(1)}h</div> <p>${topTask.name.length > 12 ? topTask.name.substring(0, 12) + '…' : topTask.name}</p> </div>`;
        },
        renderChart() {
            if (this.state.chartInstance) this.state.chartInstance.destroy();
            const ctx = this.elements.taskChartCanvas.getContext('2d');
            this.state.chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: this.state.tasks.map(t => t.name),
                    datasets: [{
                        label: '週間作業時間',
                        data: this.state.tasks.map(t => t.weeklyHours),
                        backgroundColor: ['#00b894', '#00cec9', '#55efc4', '#81ecec', '#74b9ff', '#0984e3', '#a29bfe', '#6c5ce7'],
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.label || ''}: ${context.parsed.toFixed(1)} 時間`
                            }
                        }
                    }
                }
            });
        },
        renderAutomationSuggestions() {
            const suggestions = [];
            const industry = this.state.userData.industry || 'other';
            const rules = suggestionRules[industry] ? [...suggestionRules[industry], ...suggestionRules.default] : suggestionRules.default;
            const uniqueSuggestions = new Set();

            const sortedTasks = [...this.state.tasks].sort((a, b) => b.weeklyHours - a.weeklyHours);
            sortedTasks.forEach(task => {
                if (task.weeklyHours >= 1) {
                    for (const rule of rules) {
                        if (task.name.match(rule.pattern) && !uniqueSuggestions.has(rule.s)) {
                            suggestions.push({ task: task.name, suggestion: rule.s, effect: rule.e });
                            uniqueSuggestions.add(rule.s);
                            break; 
                        }
                    }
                }
            });
            
            if (suggestions.length === 0) {
                this.elements.automationSuggestions.innerHTML = `<h3>💡 効率化のヒント</h3><div class="suggestion-item"><strong>素晴らしい！</strong><br>現状、特に自動化が推奨される長時間・定型的な作業は見つかりませんでした。もし他に隠れた作業があれば、追加で記録してみましょう。</div>`;
                return;
            }
            
            this.elements.automationSuggestions.innerHTML = `
                <h3 style="text-align:center;">🚀 【${this.elements.industry.options[this.elements.industry.selectedIndex].text}向け】効率化できそうな作業 TOP${Math.min(suggestions.length, 3)}</h3>
                ${suggestions.slice(0, 3).map(s => `
                    <div class="suggestion-item">
                        <strong>${s.task}</strong><br>${s.suggestion}<br>
                        <span style="color: #00b894; font-weight: bold;">期待効果: ${s.effect}</span>
                    </div>
                `).join('')}
                <div style="margin-top: 15px; padding: 15px; background: #e8f4f8; border-radius: 8px;">
                    <strong>💡 次のステップ</strong><br>これらの作業について、上司や同僚と改善策を相談してみましょう。小さな改善の積み重ねが大きな成果に繋がります。
                </div>`;
        },
        saveState() {
            localStorage.setItem('workVisAppIndustry', JSON.stringify(this.state));
        },
        loadState() {
            const savedState = localStorage.getItem('workVisAppIndustry');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                delete parsedState.chartInstance;
                this.state = { ...this.state, ...parsedState };
                this.elements.userName.value = this.state.userData.name || '';
                this.elements.industry.value = this.state.userData.industry || '';
                this.elements.workDays.value = this.state.userData.days || '';
            }
        },
        resetApp() {
            if (confirm('本当によろしいですか？すべてのデータが消去されます。')) {
                localStorage.removeItem('workVisAppIndustry');
                this.state = { currentStep: 1, tasks: [], userData: {}, chartInstance: this.state.chartInstance };
                if (this.state.chartInstance) this.state.chartInstance.destroy();
                this.state.chartInstance = null;
                // フォームクリア
                ['userName', 'industry', 'workDays', 'taskName', 'taskFreq', 'taskTime'].forEach(key => {
                    this.elements[key].value = '';
                });
                this.updateTaskList();
                this.clearErrors();
                this.goToStep(1, true);
            }
        }
    };

    App.init();
});
</script>
</body>
</html>